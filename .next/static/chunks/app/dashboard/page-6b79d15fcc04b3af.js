(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{5577:function(e,t,o){Promise.resolve().then(o.bind(o,9252))},9376:function(e,t,o){"use strict";var r=o(5475);o.o(r,"useRouter")&&o.d(t,{useRouter:function(){return r.useRouter}}),o.o(r,"useSearchParams")&&o.d(t,{useSearchParams:function(){return r.useSearchParams}})},5775:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s}});let r=o(7043);o(7437),o(2265);let n=r._(o(5602));function s(e,t){var o;let r={loading:e=>{let{error:t,isLoading:o,pastDelay:r}=e;return null}};"function"==typeof e&&(r.loader=e);let s={...r,...t};return(0,n.default)({...s,modules:null==(o=s.loadableGenerated)?void 0:o.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1523:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return n}});let r=o(8993);function n(e){let{reason:t,children:o}=e;if("undefined"==typeof window)throw new r.BailoutToCSRError(t);return o}},5602:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let r=o(7437),n=o(2265),s=o(1523),l=o(49);function a(e){return{default:e&&"default"in e?e.default:e}}let u={loader:()=>Promise.resolve(a(()=>null)),loading:null,ssr:!0},i=function(e){let t={...u,...e},o=(0,n.lazy)(()=>t.loader().then(a)),i=t.loading;function c(e){let a=i?(0,r.jsx)(i,{isLoading:!0,pastDelay:!0,error:null}):null,u=t.ssr?(0,r.jsxs)(r.Fragment,{children:["undefined"==typeof window?(0,r.jsx)(l.PreloadCss,{moduleIds:t.modules}):null,(0,r.jsx)(o,{...e})]}):(0,r.jsx)(s.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(o,{...e})});return(0,r.jsx)(n.Suspense,{fallback:a,children:u})}return c.displayName="LoadableComponent",c}},49:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return s}});let r=o(7437),n=o(544);function s(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let o=(0,n.getExpectedRequestStore)("next/dynamic css"),s=[];if(o.reactLoadableManifest&&t){let e=o.reactLoadableManifest;for(let o of t){if(!e[o])continue;let t=e[o].files.filter(e=>e.endsWith(".css"));s.push(...t)}}return 0===s.length?null:(0,r.jsx)(r.Fragment,{children:s.map(e=>(0,r.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:o.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},9252:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return i}});var r=o(7437),n=o(2265),s=o(9376),l=o(1245),a=o(5775);let u=o.n(a)()(()=>o.e(679).then(o.bind(o,5679)),{loadableGenerated:{webpack:()=>[5679]},ssr:!1,loading:()=>(0,r.jsx)("div",{className:"flex h-screen items-center justify-center bg-gray-900",children:(0,r.jsx)("div",{className:"text-white text-lg",children:"Loading dashboard..."})})});function i(){let e=(0,s.useRouter)(),{user:t,loading:o}=(0,l.a)();return((0,n.useEffect)(()=>{o||t||e.push("/login")},[t,o,e]),o)?(0,r.jsx)("div",{className:"flex h-screen items-center justify-center bg-gray-900",children:(0,r.jsx)("div",{className:"text-white text-lg",children:"Loading..."})}):t?(0,r.jsx)(u,{}):(0,r.jsx)("div",{className:"flex h-screen items-center justify-center bg-gray-900",children:(0,r.jsx)("div",{className:"text-white text-lg",children:"Redirecting to login..."})})}},1245:function(e,t,o){"use strict";o.d(t,{H:function(){return u},a:function(){return i}});var r=o(7437),n=o(2265),s=o(8123),l=o(6634);let a=(0,n.createContext)(void 0);function u(e){let{children:t}=e,[o,u]=(0,n.useState)(null),[i,c]=(0,n.useState)(!0);(0,n.useEffect)(()=>{console.log("AuthProvider: Initializing"),(async()=>{try{console.log("AuthProvider: Checking current user");let t=localStorage.getItem("supabase_access_token"),o=localStorage.getItem("facebook_auth_completed");if(t&&o){var e;console.log("AuthProvider: Found OAuth tokens, setting session");let{data:o,error:r}=await l.O.auth.setSession({access_token:t,refresh_token:localStorage.getItem("supabase_refresh_token")||""});if(r&&console.error("AuthProvider: Error setting session",r),null==o?void 0:null===(e=o.session)||void 0===e?void 0:e.user){console.log("AuthProvider: User authenticated from OAuth tokens",o.session.user),u(o.session.user),c(!1);return}}try{let e=await (0,s.ts)();console.log("AuthProvider: Current user result:",e),u(e)}catch(e){console.log("AuthProvider: No authenticated user found",e),localStorage.getItem("facebook_access_token")?(console.log("AuthProvider: Found Facebook token, creating mock user"),u({id:"facebook-user",email:"facebook-user@zenith.local",user_metadata:{provider:"facebook"}})):u(null)}}catch(e){console.log("AuthProvider: User not logged in",e),localStorage.getItem("facebook_access_token")?(console.log("AuthProvider: Found Facebook token, creating mock user"),u({id:"facebook-user",email:"facebook-user@zenith.local",user_metadata:{provider:"facebook"}})):u(null)}finally{console.log("AuthProvider: Finished checking user"),c(!1)}})(),console.log("AuthProvider: Setting up auth state listener");let{data:e}=l.O.auth.onAuthStateChange((e,t)=>{console.log("AuthProvider: Auth state changed:",e,t),(null==t?void 0:t.user)?(console.log("AuthProvider: User authenticated",t.user),u(t.user)):(console.log("AuthProvider: No user in session"),localStorage.getItem("facebook_access_token")?(console.log("AuthProvider: Found Facebook token, creating mock user"),u({id:"facebook-user",email:"facebook-user@zenith.local",user_metadata:{provider:"facebook"}})):u(null)),c(!1)});return()=>{console.log("AuthProvider: Cleaning up auth listener"),null==e||e.subscription.unsubscribe()}},[]);let d=async()=>{try{console.log("AuthProvider: Logging out user"),await (0,s.TX)(),localStorage.removeItem("facebook_access_token"),localStorage.removeItem("facebook_auth_completed"),localStorage.removeItem("supabase_access_token"),localStorage.removeItem("supabase_refresh_token"),u(null)}catch(e){console.error("AuthProvider: Error logging out:",e),localStorage.removeItem("facebook_access_token"),localStorage.removeItem("facebook_auth_completed"),localStorage.removeItem("supabase_access_token"),localStorage.removeItem("supabase_refresh_token"),u(null)}};return console.log("AuthProvider: Rendering with state",{user:o,loading:i}),(0,r.jsx)(a.Provider,{value:{user:o,loading:i,logout:d},children:t})}function i(){let e=(0,n.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return console.log("useAuth: Returning context",e),e}},8123:function(e,t,o){"use strict";o.d(t,{TX:function(){return a},a$:function(){return n},eu:function(){return l},pH:function(){return s},ts:function(){return u}});var r=o(6634);async function n(e,t){console.log("Registering user with email:",e);let{data:o,error:n}=await r.O.auth.signUp({email:e,password:t});if(n)throw console.error("Registration error:",n),Error(n.message);return console.log("Registration successful:",o),o}async function s(e,t){console.log("Logging in user with email:",e);let{data:o,error:n}=await r.O.auth.signInWithPassword({email:e,password:t});if(n)throw console.error("Login error:",n),Error(n.message);return console.log("Login successful:",o),o}async function l(){let e="".concat(window.location.origin,"/auth/callback");console.log("Initiating Facebook OAuth with redirect URL:",e);let{data:t,error:o}=await r.O.auth.signInWithOAuth({provider:"facebook",options:{redirectTo:e,queryParams:{scope:"public_profile,email,pages_show_list,pages_manage_posts"}}});if(o){if(console.error("Facebook OAuth error:",o),console.error("Error details:",{message:o.message,status:o.status,name:o.name}),o.message.includes("external provider")){console.log("Trying with basic scopes...");let{data:t,error:o}=await r.O.auth.signInWithOAuth({provider:"facebook",options:{redirectTo:e,queryParams:{scope:"public_profile,email,pages_show_list,pages_manage_posts"}}});if(o)throw console.error("Retry failed:",o),Error(o.message);return console.log("Retry successful:",t),t}throw Error(o.message)}return console.log("Facebook OAuth initiated successfully:",t),t}async function a(){console.log("Logging out user");let{error:e}=await r.O.auth.signOut();if(e)throw console.error("Logout error:",e),Error(e.message);return console.log("Logout successful"),!0}async function u(){console.log("Getting current user");let{data:e,error:t}=await r.O.auth.getUser();if(t)throw console.error("Get user error:",t),Error(t.message);return console.log("Current user:",e.user),e.user}},6634:function(e,t,o){"use strict";o.d(t,{O:function(){return r}});let r=(0,o(8439).eI)("https://qfpvsyhtijwxkmyrqswa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0")}},function(e){e.O(0,[439,971,117,744],function(){return e(e.s=5577)}),_N_E=e.O()}]);